{% extends 'base.html.twig' %}

{% block title %}Bienvenue sur Energreen
{% endblock %}

{% block body %}
	<style>
		.bg-energreen {
			background-color: #1A361C !important;
			color: white;
		}
		.btn-energreen {
			background-color: #1A361C !important;
			border-color: #1A361C !important;
			color: white;
		}
		.btn-energreen:hover {
			background-color: #142a15 !important;
			border-color: #c1c2c1ff !important;
			color: #c1c2c1ff !important;
		}
		.bg-form {
			background-color: #493315 !important;
			color: white;
		}
		.btn-form {
			background-color: #493315 !important;
			border-color: #493315 !important;
			color: white;
		}
		.btn-form:hover {
			background-color: #362612 !important;
			border-color: #362612 !important;
			color: white;
		}
	</style>


	<div class="container mt-5">
		<div class="row justify-content-center">
			<div class="col-md-8">
				<div class="card shadow-lg border-0 rounded-lg">
					<div class="card-header bg-form text-white text-center py-4">
						<h2 class="mb-0">Bienvenue sur Energreen</h2>
					</div>
					<div class="card-body p-5">
						<div class="text-center mb-4">
							<p class="lead text-muted">Votre consommation en un clic.</p>
						</div>

						<div class="row">
							<div class="col p-4">
								<h2 class="mb-0">Dites-nous plus sur votre logement</h2>
								<p class="text-muted pt-4">Merci de nous donner plus de détails sur votre logement.</p>
							</div>
							<div class="col p-4">
								<form id="welcomeForm" action="{{ path('app_energreen_welcome') }}" method="POST">
									<div class="mb-3">
										<label class="form-label fw-bold mt-2">Consommation du mois dernier</label>
										<div class="row g-2">
											<div class="col-md-6">
												<label for="past_consumption" class="form-label small text-muted">Consommation en kWh</label>
												<input type="number" step="0.01" class="form-control" name="past_consumption" id="past_consumption" placeholder="Ex: 250">
											</div>
											<div class="col-md-6">
												<label for="billing_date" class="form-label small text-muted">Date de facturation</label>
												<input type="date" class="form-control" name="billing_date" id="billing_date">
											</div>
										</div>
									</div>
									<label for="type_logement" class="form-label fw-bold mt-2">Logement</label>
									<div class="mb-3">
										<select class="form-select" name="lodgment_type" id="type_logement" aria-label="Default select example">
											<option value="">Type de logement</option>
											<option value="Studio">Studio</option>
											<option value="Appartement">Appartement</option>
											<option value="Maison">Maison</option>
										</select>
									</div>
									<div class="mb-3">
										<input type="number" class="form-control" name="surface" id="surface" placeholder="Surface en m2">
									</div>
									<div class="mb-3">
										<input type="number" class="form-control" name="occupants" id="occupants" placeholder="Nombre d'occupants">
									</div>

									<div class="mb-3">
										<label for="interest" class="form-label fw-bold mt-2">Selectionnez tous les appareils present dans votre logement</label>
										<div class="dropdown">
											<button class="btn btn-outline-secondary dropdown-toggle w-100 d-flex justify-content-between align-items-center" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
												Sélectionner des appareils...
											</button>
											<ul class="dropdown-menu w-100 p-3" aria-labelledby="dropdownMenuButton" style="max-height: 300px; overflow-y: auto;">
												<li>
													<div class="form-check">
														<input class="form-check-input" type="checkbox" name="appliances[]" value="1" id="checkTV">
														<label class="form-check-label" for="checkTV">Television</label>
													</div>
												</li>
												<li>
													<div class="form-check">
														<input class="form-check-input" type="checkbox" name="appliances[]" value="2" id="checkRefrigerateur">
														<label class="form-check-label" for="checkRefrigerateur">Refrigerateur</label>
													</div>
												</li>
												<li>
													<div class="form-check">
														<input class="form-check-input" type="checkbox" name="appliances[]" value="3" id="checkCongelateur">
														<label class="form-check-label" for="checkCongelateur">Congelateur Coffre</label>
													</div>
												</li>
												<li>
													<div class="form-check">
														<input class="form-check-input" type="checkbox" name="appliances[]" value="4" id="checkPC">
														<label class="form-check-label" for="checkPC">Ordinateur de bureau</label>
													</div>
												</li>
												<li>
													<div class="form-check">
														<input class="form-check-input" type="checkbox" name="appliances[]" value="5" id="checkPortable">
														<label class="form-check-label" for="checkPortable">Ordinateur portable</label>
													</div>
												</li>
												<li>
													<div class="form-check">
														<input class="form-check-input" type="checkbox" name="appliances[]" value="6" id="checkPhone">
														<label class="form-check-label" for="checkPhone">Smartphone/tablette</label>
													</div>
												</li>
												<li>
													<div class="form-check">
														<input class="form-check-input" type="checkbox" name="appliances[]" value="7" id="checkDSL">
														<label class="form-check-label" for="checkDSL">Modem DSL</label>
													</div>
												</li>
												<li>
													<div class="form-check">
														<input class="form-check-input" type="checkbox" name="appliances[]" value="8" id="checkDecodeur">
														<label class="form-check-label" for="checkDecodeur">Decodeur</label>
													</div>
												</li>
												<li>
													<div class="form-check">
														<input class="form-check-input" type="checkbox" name="appliances[]" value="9" id="checkConsole">
														<label class="form-check-label" for="checkConsole">Console de jeu</label>
													</div>
												</li>
												<li><hr class="dropdown-divider"></li>
												<li>
													<div class="form-check">
														<input class="form-check-input" type="checkbox" name="appliances[]" value="10" id="checkLaveLinge">
														<label class="form-check-label" for="checkLaveLinge">Lave-linge</label>
													</div>
												</li>
												<li>
													<div class="form-check">
														<input class="form-check-input" type="checkbox" name="appliances[]" value="11" id="checkSecheLinge">
														<label class="form-check-label" for="checkSecheLinge">seche-linge</label>
													</div>
												</li>
												<li>
													<div class="form-check">
														<input class="form-check-input" type="checkbox" name="appliances[]" value="12" id="checkLaveVaisselle">
														<label class="form-check-label" for="checkLaveVaisselle">Lave-vaisselle</label>
													</div>
												</li>
												<li>
													<div class="form-check">
														<input class="form-check-input" type="checkbox" name="appliances[]" value="13" id="checkFour">
														<label class="form-check-label" for="checkFour">Four électrique</label>
													</div>
												</li>
												<li>
													<div class="form-check">
														<input class="form-check-input" type="checkbox" name="appliances[]" value="14" id="checkPlaqueCuisson">
														<label class="form-check-label" for="checkPlaqueCuisson">Plaque de cuisson</label>
													</div>
												</li>
												<li><hr class="dropdown-divider"></li>
												<li>
													<div class="form-check">
														<input class="form-check-input" type="checkbox" name="appliances[]" value="15" id="checkChaudiere">
														<label class="form-check-label" for="checkChaudiere">Chaudière</label>
													</div>
												</li>
												<li>
													<div class="form-check">
														<input class="form-check-input" type="checkbox" name="appliances[]" value="16" id="checkRadiateur">
														<label class="form-check-label" for="checkRadiateur">Radiateur électrique</label>
													</div>
												</li>
												<li>
													<div class="form-check">
														<input class="form-check-input" type="checkbox" name="appliances[]" value="17" id="checkVentilateur">
														<label class="form-check-label" for="checkVentilateur">Ventilateur</label>
													</div>
												</li>
												<li>
													<div class="form-check">
														<input class="form-check-input" type="checkbox" name="appliances[]" value="18" id="checkEclairage">
														<label class="form-check-label" for="checkEclairage">Eclairage (Ampoules)</label>
													</div>
												</li>
											</ul>
										</div>
									</div>

									<div id="selected-appliances" class="mt-3"></div>

									<div class="d-grid gap-2 mt-4">
										<button type="submit" class="btn btn-form btn-sm">Commencer</button>
									</div>
								</form>
							</div>
						</div>


					</div>

					>
				</div>
			</div>
		</div>
	</div>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<script>
		document.addEventListener('DOMContentLoaded', function () {
const form = document.getElementById('welcomeForm');
if (form) {
form.addEventListener('submit', function (e) {
e.preventDefault();

// Afficher SweetAlert avant de soumettre
Swal.fire({
title: 'Merci !',
text: 'Vos informations ont bien été enregistrées.',
icon: 'success',
showConfirmButton: false,
timer: 2000
}).then(() => { // Soumettre le formulaire au serveur
form.submit();
});
});
}

const checkboxes = document.querySelectorAll('.dropdown-menu .form-check-input');
const badgeContainer = document.getElementById('selected-appliances');
// ... (rest of the existing script)

// Empêcher la fermeture du menu dropdown lors du clic sur un élément à l'intérieur
document.querySelectorAll('.dropdown-menu').forEach(function (element) {
element.addEventListener('click', function (e) {
e.stopPropagation();
});
});

// Mettre à jour les badges
checkboxes.forEach(function (checkbox) {
checkbox.addEventListener('change', updateBadges);
});

function updateBadges() {
badgeContainer.innerHTML = '';
// Vider les badges actuels

// Palette de couleurs pour les badges (couleurs compatibles avec texte blanc)
const colors = [
'#0d6efd', // Primary Blue
'#6c757d', // Secondary Grey
'#1A361C', // Energreen Green
'#dc3545', // Danger Red
'#6610f2', // Purple
'#d63384', // Pink
'#fd7e14', // Orange
'#20c997', // Teal
'#212529', // Dark
'#008080', // Teal Dark
'#4B0082' // Indigo
];

checkboxes.forEach(function (checkbox) {
if (checkbox.checked) {
const label = checkbox.nextElementSibling.textContent;

// Choix de la couleur basé sur la valeur pour que ce soit stable mais "aléatoire"
const colorIndex = parseInt(checkbox.value) % colors.length;
const bgColor = colors[colorIndex];

const badge = document.createElement('span');
badge.className = 'badge me-2 mb-2 p-2';
badge.style.fontSize = '0.9em';
badge.style.backgroundColor = bgColor;
badge.style.color = 'white';
badge.textContent = label;

const closeBtn = document.createElement('span');
closeBtn.innerHTML = ' &times;';
closeBtn.style.cursor = 'pointer';
closeBtn.style.marginLeft = '8px';

closeBtn.onclick = function () {
checkbox.checked = false;
updateBadges();
};

badge.appendChild(closeBtn);
badgeContainer.appendChild(badge);
}
});
}
});
	</script>
{% endblock %}
